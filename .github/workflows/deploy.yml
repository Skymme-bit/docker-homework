name: Docker Self-Hosted Runner Connection Test

on:
  push:
    branches:
      - main

jobs:
  docker-connection-test:
    runs-on: self-hosted
    steps:
      - name: Check PowerShell Version in GitHub Actions
        shell: powershell
        run: |
          $PSVersionTable

      - name: Show Runner User
        shell: powershell
        run: whoami

      - name: Debug Docker Password Length
        shell: powershell
        run: |
          $password = "${{ secrets.DOCKER_PASSWORD }}"
          Write-Output "Password Length: $($password.Length)"


      - name: Verify Docker CLI
        shell: powershell
        env:
          DOCKER_HOST: ${{ secrets.DOCKER_HOST }}
        run: |
          echo "Using Docker Host: $env:DOCKER_HOST"
          docker version
          docker info

      - name: Test Docker Network Connectivity
        shell: powershell
        env:
          DOCKER_HOST: ${{ secrets.DOCKER_HOST }}
        run: |
          docker pull alpine

      - name: Secure Docker Login
        shell: powershell
        run: |
          docker login -u "${{ secrets.DOCKER_USERNAME }}" -p "${{ secrets.DOCKER_PASSWORD }}" 2> $null
      
      
